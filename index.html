<html>
  <head>
    <script src='jam/require.js'></script>
    <link rel='stylesheet' type='text/css' href='css/bootstrap.css'>
    <link rel='stylesheet' type='text/css' href='css/style.css'>
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-29474408-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>

  <body>
<div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "https://connect.facebook.net/en_GB/all.js#xfbml=1&appId=278976971594";
      fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));</script>

    <div class='container'>
      <div class='row'>
        <div id='instructions' class='span6 offset0p5'>
          <h1>Violin <small>Instrumenting JavaScript</small></h1>

          <p class='p-first'>
            This is an experiment in instrumenting JavaScript applications. 
          </p>

          <p>
            On the right is the Object and Function graph for
            a simple Backbone app (<a href='#' rel='show-code' data-content='view'> the code</a>). 
          </p>

          <p>
            The app's code has been instrumented to draw and animate the graph as the JavaScript runs without having to modify the app's original code at all (by hand anyway).
          </p> 

          <p>Hit the button to start the backbone app and interact with it.</p>
          
          <p><i>Metaprogramming rocks :)</i>.</p>

          <div class='well'>
            <h2>The App</h2>
            <a href='#' rel='startApp' class='btn btn-primary'>Start the backbone app</a>
            <div id='content'></div>
          </div>
          
          <p>
            This is an experiment by <a href='http://blog.latentflip.com'>Philip Roberts</a>. You can follow me on twitter <a href='http://twitter.com'>@philip_roberts</a>.
          </p>

          <p>
            If you have any thoughts <a href='#comments'>please leave me a comment</a>.
          </p>

          <div class="fb-like" data-send="true" data-layout="button_count" data-width="100" data-show-faces="false"></div>
          <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://bit.ly/RoRp52" data-text="Visualizing and instrumenting Javascript apps" data-via="philip_roberts">Tweet</a>
          <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

          <div id='the-code'>
            <h3>The App Code</h3>
            <script src="https://gist.github.com/3964362.js"></script>
          </div>

        </div>
        <div id='chart' class='span5p5'></div>
      </div>

      <div class='row discussion'>
        <div class='span12'>
          <h2>Discussion</h2>
        </div>
        <div class='span12'>
          <p class='p-first'>This is a first attempt at instrumenting a JavaScript application.</p>

          <p>
            Instrumenting is performed by recursively iterating over the application's namespace to build the graph, and decorating any functions to trigger events when they are called.
          </p>

          <p>
            Currently the graph shows the Object heirarchy, rather than the prototype hierarchy or all the instantiations of the object, and function nodes on the graph will be triggered when any instantiation of that object calls the function.
          </p>

          <h2>The code</h2>
          <script src="https://gist.github.com/3964466.js"> </script>

          <a name='comments'></a>
          <h2>Comments</h2>
          <div id="disqus_thread"></div>
          <script type="text/javascript">
              /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
              var disqus_shortname = 'latentflipgithub'; // required: replace example with your forum shortname

              /* * * DON'T EDIT BELOW THIS LINE * * */
              (function() {
                  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        

        </div>
      </div>
    </div>

    <footer>
      <a href="https://github.com/latentflip/violin"><img id="fork" src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>
    </footer>

    <script>
      require(['app'], function(App) {
        $(function() {
          $('a[rel=startApp]').click( function() {
            $(this).remove()
            App.init()
          });

          $('a[rel=show-code]').click( function() {
            var $gist = $('#the-code');
            if ($gist.is(':visible')) {
              $gist.slideUp();
              $(this).attr('data-content', 'view')
            } else {
              $gist.slideDown(200);
              $(this).attr('data-content', 'hide')
            }
            
          });


        });
        $('a[href="#comments"]').click(function(e) {
          e.preventDefault();
          $('html, body').animate({
            scrollTop: $("a[name=comments]").offset().top
          }, 500);
        });
      });
    </script>



  </body>

</html>
